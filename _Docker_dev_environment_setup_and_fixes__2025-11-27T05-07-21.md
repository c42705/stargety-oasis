[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
endpoints, Socket.IO broadcasts, multer uploads
-[ ] NAME:localStorage â†’ PostgreSQL Migration DESCRIPTION:Comprehensive migration of all localStorage data to PostgreSQL database with Prisma ORM
--[ ] NAME:Phase 1: Database Schema & Infrastructure DESCRIPTION:Foundation layer - expand Prisma schema, run migrations, setup file uploads
---[ ] NAME:1.1 Expand Prisma Schema DESCRIPTION:Add Character, MapAsset, UserSettings, JitsiRoomMapping, PlayerPosition models to schema.prisma
---[ ] NAME:1.2 Run Prisma Migrations DESCRIPTION:Generate and apply migrations: npx prisma migrate dev --name add_all_models
---[ ] NAME:1.3 Setup File Upload Infrastructure DESCRIPTION:Configure multer middleware, /uploads static route, file validation (40MB limit, image types)
---[ ] NAME:1.4 Create Seed Data Script DESCRIPTION:Create prisma/seed.ts with default map, sample interactive areas, test character slots
--[ ] NAME:Phase 2: Server API Layer - Maps DESCRIPTION:Backend API for map data CRUD and real-time sync
---[ ] NAME:2.1 Enhance mapController CRUD DESCRIPTION:Add full CRUD operations: GET/POST/PUT/DELETE /api/maps/:roomId with Prisma
---[ ] NAME:2.2 Create Map Assets API DESCRIPTION:POST /api/maps/:roomId/assets (upload), GET /api/maps/:roomId/assets, DELETE /api/maps/:roomId/assets/:assetId
---[ ] NAME:2.3 Add Map Socket.IO Events DESCRIPTION:Emit map:updated, map:asset:added, map:asset:removed for real-time multi-user sync
--[ ] NAME:Phase 3: Server API Layer - Characters DESCRIPTION:Backend API for character/avatar slot management
---[ ] NAME:3.1 Create characterController DESCRIPTION:CRUD for /api/characters/:userId/slots, /api/characters/:userId/slots/:slotNumber
---[ ] NAME:3.2 Character File Uploads DESCRIPTION:POST /api/characters/upload for thumbnails and cached textures, store in /uploads/characters/
---[ ] NAME:3.3 Active Character Endpoint DESCRIPTION:GET/PUT /api/characters/:userId/active for current slot selection
--[ ] NAME:Phase 4: Server API Layer - Settings & Config DESCRIPTION:Backend API for user settings, Jitsi mappings, player position
---[ ] NAME:4.1 Create settingsController DESCRIPTION:GET/PUT /api/settings/:userId for theme, jitsiServerUrl, editorPrefs (JSONB)
---[ ] NAME:4.2 Create jitsiMappingController DESCRIPTION:CRUD /api/jitsi-mappings for area-to-room mappings, GET by areaId
---[ ] NAME:4.3 Create positionController DESCRIPTION:GET/PUT /api/position/:sessionId for ephemeral player world position
--[ ] NAME:Phase 5: Server API Layer - Chat DESCRIPTION:Backend API for chat messages with Socket.IO integration
---[ ] NAME:5.1 Create chatController DESCRIPTION:GET /api/chat/:roomId/messages (with pagination), POST /api/chat/:roomId/messages
---[ ] NAME:5.2 Chat Socket.IO Integration DESCRIPTION:Handle chat:message events, persist to DB, broadcast to room members
---[ ] NAME:5.3 Message TTL Cleanup DESCRIPTION:Implement scheduled cleanup for messages older than 8 hours (pg_cron or node-cron)
--[ ] NAME:Phase 6: Client API Services DESCRIPTION:Create API client services that abstract backend communication
---[ ] NAME:6.1 Create MapApiService.ts DESCRIPTION:Client API service with loadMap(), saveMap(), getAssets(), uploadAsset() matching localStorage interface
---[ ] NAME:6.2 Create CharacterApiService.ts DESCRIPTION:loadCharacterSlot(), saveCharacterSlot(), setActiveCharacter(), uploadTexture()
---[ ] NAME:6.3 Create AssetApiService.ts DESCRIPTION:uploadAsset(), getAsset(), deleteAsset() for map image assets
---[ ] NAME:6.4 Create SettingsApiService.ts DESCRIPTION:loadSettings(), saveSettings() for user preferences
---[ ] NAME:6.5 Create JitsiMappingApiService.ts DESCRIPTION:getMappings(), setMapping(), removeMapping() for Jitsi room mappings
--[ ] NAME:Phase 7: Client Integration - Maps DESCRIPTION:Replace localStorage with API calls in map-related modules
---[ ] NAME:7.1 Update SharedMapSystem.ts DESCRIPTION:Replace localStorage reads/writes with MapApiService, add Socket.IO sync listeners
---[ ] NAME:7.2 Update MapDataService.ts DESCRIPTION:Use MapApiService with optional in-memory cache for performance
---[ ] NAME:7.3 Update MapDataContext.tsx DESCRIPTION:Connect React context to new service layer, handle async loading states
---[ ] NAME:7.4 Update imageProcessing.ts DESCRIPTION:Replace storeImageInLocalStorage with AssetApiService.uploadAsset()
---[ ] NAME:7.5 Update AssetsTab.tsx DESCRIPTION:Load saved assets from API, remove localStorage fallback
--[ ] NAME:Phase 8: Client Integration - Characters DESCRIPTION:Replace localStorage with API calls in avatar/character modules
---[ ] NAME:8.1 Update CharacterStorage.ts (v2) DESCRIPTION:Replace all localStorage operations with CharacterApiService calls
---[ ] NAME:8.2 Update AvatarBuilderStorage.ts (v1) DESCRIPTION:Migrate to CharacterApiService or consolidate with v2 system
---[ ] NAME:8.3 Update Avatar UI Components DESCRIPTION:Ensure AvatarBuilderIntegration.tsx and related UIs use new API services
--[ ] NAME:Phase 9: Client Integration - Settings & Config DESCRIPTION:Replace localStorage with API calls in settings modules
---[ ] NAME:9.1 Update SettingsContext.tsx DESCRIPTION:Load/save via SettingsApiService, maintain theme reactivity
---[ ] NAME:9.2 Update JitsiRoomMappingService.ts DESCRIPTION:Sync mappings with database via JitsiMappingApiService
---[ ] NAME:9.3 Update Editor Preferences DESCRIPTION:Persist konvaConstants STORAGE_KEYS (grid, viewport, tools) to UserSettings
--[ ] NAME:Phase 10: Testing & Verification DESCRIPTION:End-to-end testing of all migrated functionality
---[ ] NAME:10.1 Test Map CRUD Operations DESCRIPTION:Verify create, load, update, delete maps in browser with DB persistence
---[ ] NAME:10.2 Test Character Slot System DESCRIPTION:Test all 5 slots, switching active character, thumbnail generation/display
---[ ] NAME:10.3 Test Asset Uploads DESCRIPTION:Upload images to map, verify storage in /uploads, retrieval via API
---[ ] NAME:10.4 Test Real-time Sync DESCRIPTION:Open multiple tabs, verify map changes sync via Socket.IO
---[ ] NAME:10.5 Test Settings Persistence DESCRIPTION:Change theme, Jitsi URL - verify persistence across browser sessions